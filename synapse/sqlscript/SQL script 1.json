{
	"name": "SQL script 1",
	"properties": {
		"content": {
			"query": "--Creating the user for Service principal used for connecting to Azure Data Lake Storage and Azure Synapse Analytics\n-- CREATE USER [Rebrickable-Dev-Databricks] FROM EXTERNAL PROVIDER;\n-- GO\n--Granting thr db owner role to SP user and additional privileges to be able to create and load the tables with data\n-- EXEC sp_addrolemember db_owner, [Rebrickable-Dev-Databricks];\n-- GRANT ADMINISTER DATABASE BULK OPERATIONS TO [Rebrickable-Dev-Databricks]\n\n-- GRANT CREATE TABLE TO [Rebrickable-Dev-Databricks]\n-- GRANT ALTER ON SCHEMA ::dbo TO [Rebrickable-Dev-Databricks]\n\n-- CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'Rebrickable1234'\n--Checking if the data was loaded to the tables\n-- select * from dbo.OwnedSets\n-- select * from dbo.Date\n-- select * from dbo.Sets\n-- select * from dbo.Profile\n\n--Recreating the tables using CTAS to add the proper distribution and index\n\n--OwnedSets - used the Hash Distribution since the Table is a Fact table in our DW. We assume that we are going to load here also the data for other users so the best column for distribution is Profile_ID.\n\nCREATE SCHEMA Rebrickable\nGO\nCREATE TABLE Rebrickable.OwnedSets\nWITH (\n    CLUSTERED COLUMNSTORE INDEX,\n    DISTRIBUTION = HASH (Profile_ID)\n    )\nAS\nSELECT *\nFROM dbo.OwnedSets\nGO\n\nDROP TABLE dbo.OwnedSets\nGO\n\n--Sets, Date, Profile - used the Replicate distribution since those tables are dimension tables in our DW.\n\nCREATE TABLE Rebrickable.Sets\nWITH (\n    HEAP,\n    DISTRIBUTION = REPLICATE\n    )\nAS\nSELECT *\nFROM dbo.Sets\nGO\n\nDROP TABLE dbo.Sets\nGO\n\nCREATE TABLE Rebrickable.Profile\nWITH (\n    HEAP,\n    DISTRIBUTION = REPLICATE\n    )\nAS\nSELECT *\nFROM dbo.Profile\nGO\n\nDROP TABLE dbo.Profile\nGO\n\nCREATE TABLE Rebrickable.Date\nWITH (\n    HEAP,\n    DISTRIBUTION = REPLICATE\n    )\nAS\nSELECT *\nFROM dbo.Date\nGO\n\nDROP TABLE dbo.Date\nGO\n\n--Creating two workload management groups for Loading purposes and Query purposes\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "Rebrickabledevsqldw",
				"poolName": "Rebrickabledevsqldw"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}